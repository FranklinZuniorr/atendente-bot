{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 6, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 60, "column": 0}, "map": {"version":3,"sources":["file:///home/fr/atendente-bot/src/app/api/repositories/client/index.ts"],"sourcesContent":["import { Client, GetClientByTelephoneResponse } from './interfaces';\nimport ClientModel from './models/client';\n\nexport class ClientRepository {\n  private clientModel: typeof ClientModel;\n  private connect: () => Promise<void>;\n\n  constructor(clientModel: typeof ClientModel, connect: () => Promise<void>) {\n    this.clientModel = clientModel;\n    this.connect = connect;\n    this.connect();\n  }\n\n  async upsert(client: Client) {\n    try {\n      const filter = { telephone: client.telephone };\n  \n      const options = { upsert: true, new: true };\n  \n      const updatedClient = await this.clientModel.findOneAndUpdate(filter, client, options);\n  \n      return updatedClient;\n    } catch (error) {\n      throw new Error('Client not created or updated!', { cause: error });\n    }\n  }\n\n  async getByTelephone(telephone: string): Promise<GetClientByTelephoneResponse> {\n    try {\n      const client: GetClientByTelephoneResponse | null = await this.clientModel.findOne({ telephone });\n\n      if (!client) throw new Error('Client not found!');\n\n      return client;\n\n    } catch (error) {\n      const errorMessage = (error as Error).message;\n      throw new Error(errorMessage);\n    }\n  }\n\n  async deleteByTelephone(telephone: string) {\n    try {\n      const response = await this.clientModel.deleteOne({ telephone });\n\n      if (response.deletedCount === 0) throw new Error('None deleted!');\n    } catch {\n      throw new Error('It was not possible delete user by db!');\n    }\n  }\n  \n  async decrementClientTokens(clientId: string) {\n    try {\n      const response = await this.clientModel.updateOne({ _id: clientId }, { $inc: { messageTokens: -1 }});\n\n      if (response.modifiedCount === 0 ) throw new Error('None updated!');\n    } catch {\n      throw new Error('It was not possible decrement user tokens!');\n    }\n  }\n\n  async incrementClientTokens(clientId: string, qty: number) {\n    try {\n      const response = await this.clientModel.updateOne({ _id: clientId }, { $inc: { messageTokens: qty }});\n\n      if (response.modifiedCount === 0 ) throw new Error('None updated!');\n    } catch {\n      throw new Error('It was not possible increment user tokens!');\n    }\n  }\n}\n"],"names":[],"mappings":";;;AAGO,MAAM;IACH,YAAgC;IAChC,QAA6B;IAErC,YAAY,WAA+B,EAAE,OAA4B,CAAE;QACzE,IAAI,CAAC,WAAW,GAAG;QACnB,IAAI,CAAC,OAAO,GAAG;QACf,IAAI,CAAC,OAAO;IACd;IAEA,MAAM,OAAO,MAAc,EAAE;QAC3B,IAAI;YACF,MAAM,SAAS;gBAAE,WAAW,OAAO,SAAS;YAAC;YAE7C,MAAM,UAAU;gBAAE,QAAQ;gBAAM,KAAK;YAAK;YAE1C,MAAM,gBAAgB,MAAM,IAAI,CAAC,WAAW,CAAC,gBAAgB,CAAC,QAAQ,QAAQ;YAE9E,OAAO;QACT,EAAE,OAAO,OAAO;YACd,MAAM,IAAI,MAAM,kCAAkC;gBAAE,OAAO;YAAM;QACnE;IACF;IAEA,MAAM,eAAe,SAAiB,EAAyC;QAC7E,IAAI;YACF,MAAM,SAA8C,MAAM,IAAI,CAAC,WAAW,CAAC,OAAO,CAAC;gBAAE;YAAU;YAE/F,IAAI,CAAC,QAAQ,MAAM,IAAI,MAAM;YAE7B,OAAO;QAET,EAAE,OAAO,OAAO;YACd,MAAM,eAAe,AAAC,MAAgB,OAAO;YAC7C,MAAM,IAAI,MAAM;QAClB;IACF;IAEA,MAAM,kBAAkB,SAAiB,EAAE;QACzC,IAAI;YACF,MAAM,WAAW,MAAM,IAAI,CAAC,WAAW,CAAC,SAAS,CAAC;gBAAE;YAAU;YAE9D,IAAI,SAAS,YAAY,KAAK,GAAG,MAAM,IAAI,MAAM;QACnD,EAAE,OAAM;YACN,MAAM,IAAI,MAAM;QAClB;IACF;IAEA,MAAM,sBAAsB,QAAgB,EAAE;QAC5C,IAAI;YACF,MAAM,WAAW,MAAM,IAAI,CAAC,WAAW,CAAC,SAAS,CAAC;gBAAE,KAAK;YAAS,GAAG;gBAAE,MAAM;oBAAE,eAAe,CAAC;gBAAE;YAAC;YAElG,IAAI,SAAS,aAAa,KAAK,GAAI,MAAM,IAAI,MAAM;QACrD,EAAE,OAAM;YACN,MAAM,IAAI,MAAM;QAClB;IACF;IAEA,MAAM,sBAAsB,QAAgB,EAAE,GAAW,EAAE;QACzD,IAAI;YACF,MAAM,WAAW,MAAM,IAAI,CAAC,WAAW,CAAC,SAAS,CAAC;gBAAE,KAAK;YAAS,GAAG;gBAAE,MAAM;oBAAE,eAAe;gBAAI;YAAC;YAEnG,IAAI,SAAS,aAAa,KAAK,GAAI,MAAM,IAAI,MAAM;QACrD,EAAE,OAAM;YACN,MAAM,IAAI,MAAM;QAClB;IACF;AACF","debugId":null}},
    {"offset": {"line": 153, "column": 0}, "map": {"version":3,"sources":["file:///home/fr/atendente-bot/src/app/api/repositories/client/models/client.ts"],"sourcesContent":["import mongoose, { Document, Schema } from 'mongoose';\nimport { Client } from '../interfaces';\n\nconst ClientSchema: Schema<Client & Document> = new Schema(\n  {\n    telephone: { type: String, required: true },\n    authCode: { type: String, required: true },\n    messageTokens: { type: Number, required: false },\n  },\n  { timestamps: true }\n);\n\nconst ClientModel = mongoose.models.Client || mongoose.model<Client>('Client', ClientSchema);\n\nexport default ClientModel;\n"],"names":[],"mappings":";;;AAAA;;AAGA,MAAM,eAA0C,IAAI,yGAAA,CAAA,SAAM,CACxD;IACE,WAAW;QAAE,MAAM;QAAQ,UAAU;IAAK;IAC1C,UAAU;QAAE,MAAM;QAAQ,UAAU;IAAK;IACzC,eAAe;QAAE,MAAM;QAAQ,UAAU;IAAM;AACjD,GACA;IAAE,YAAY;AAAK;AAGrB,MAAM,cAAc,yGAAA,CAAA,UAAQ,CAAC,MAAM,CAAC,MAAM,IAAI,yGAAA,CAAA,UAAQ,CAAC,KAAK,CAAS,UAAU;uCAEhE","debugId":null}},
    {"offset": {"line": 182, "column": 0}, "map": {"version":3,"sources":["file:///home/fr/atendente-bot/src/constants.ts"],"sourcesContent":["export const ENVS = {\n  evolutionBaseUrl: process.env.EVOLUTION_BASE_URL,\n  evolutionApiKey: process.env.EVOLUTION_API_KEY,\n  mongoUrl: process.env.MONGO_URL,\n  webhookSendMessageUrl: process.env.WEBHOOK_SEND_MESSAGE_URL,\n  openAiBaseUrl: process.env.OPEN_AI_BASE_URL,\n  openAiApiKey: process.env.OPEN_AI_API_KEY,\n  stripeCallbackUrl: process.env.STRIPE_CALLBACK_URL,\n  stripeApiCompleteKey: process.env.STRIPE_API_COMPLETE_KEY,\n  stripePriceKey: process.env.STRIPE_PRICE_KEY\n};\n\nexport const AUTH_CODE_LOCAL_STORAGE_KEY = 'AUTH_CODE_LOCAL_STORAGE_KEY';\nexport const TELEPHONE_LOCAL_STORAGE_KEY = 'TELEPHONE_LOCAL_STORAGE_KEY';\n\nexport const COLORS = {\n  main: '#009CFF',\n  mainLow: '#9DD9FF',\n  red: '#FF0000'\n};"],"names":[],"mappings":";;;;;;AAAO,MAAM,OAAO;IAClB,kBAAkB,QAAQ,GAAG,CAAC,kBAAkB;IAChD,iBAAiB,QAAQ,GAAG,CAAC,iBAAiB;IAC9C,UAAU,QAAQ,GAAG,CAAC,SAAS;IAC/B,uBAAuB,QAAQ,GAAG,CAAC,wBAAwB;IAC3D,eAAe,QAAQ,GAAG,CAAC,gBAAgB;IAC3C,cAAc,QAAQ,GAAG,CAAC,eAAe;IACzC,mBAAmB,QAAQ,GAAG,CAAC,mBAAmB;IAClD,sBAAsB,QAAQ,GAAG,CAAC,uBAAuB;IACzD,gBAAgB,QAAQ,GAAG,CAAC,gBAAgB;AAC9C;AAEO,MAAM,8BAA8B;AACpC,MAAM,8BAA8B;AAEpC,MAAM,SAAS;IACpB,MAAM;IACN,SAAS;IACT,KAAK;AACP","debugId":null}},
    {"offset": {"line": 212, "column": 0}, "map": {"version":3,"sources":["file:///home/fr/atendente-bot/src/app/api/infra/mongoDb/index.ts"],"sourcesContent":["import { ENVS } from '@/constants';\nimport mongoose from 'mongoose';\n\nconst MONGO_URI = ENVS.mongoUrl;\n\nif (!MONGO_URI) {\n  throw new Error('⚠️ MONGO_URI não foi definida no .env');\n}\n\nexport const connectDB = async (): Promise<void> => {\n  if (mongoose.connection.readyState >= 1) {\n  }\n\n  await mongoose.connect(MONGO_URI);\n};\n"],"names":[],"mappings":";;;AAAA;AACA;;;AAEA,MAAM,YAAY,kHAAA,CAAA,OAAI,CAAC,QAAQ;AAE/B,IAAI,CAAC,WAAW;IACd,MAAM,IAAI,MAAM;AAClB;AAEO,MAAM,YAAY;IACvB,IAAI,yGAAA,CAAA,UAAQ,CAAC,UAAU,CAAC,UAAU,IAAI,GAAG,CACzC;IAEA,MAAM,yGAAA,CAAA,UAAQ,CAAC,OAAO,CAAC;AACzB","debugId":null}},
    {"offset": {"line": 233, "column": 0}, "map": {"version":3,"sources":["file:///home/fr/atendente-bot/src/app/api/client/webhook/connection-update/route.ts"],"sourcesContent":["import { NextResponse } from 'next/server';\nimport { WebhookMessageEventBody } from '../../interfaces';\nimport { ClientRepository } from '../../../repositories/client';\nimport ClientModel from '../../../repositories/client/models/client';\nimport { connectDB } from '../../../infra/mongoDb';\n\nconst clientRepository = new ClientRepository(ClientModel, connectDB);\n\nexport async function POST(req: Request) {\n  try {\n    const body: WebhookMessageEventBody = await req.json();\n    const client = await clientRepository.getByTelephone(body.instance);\n\n    console.log(body);\n\n    return NextResponse.json({}, { status: 400 });\n  } catch {\n    return NextResponse.json({ message: 'Nenhum dado enviado!' }, { status: 400 });\n  }\n}\n\n"],"names":[],"mappings":";;;AAAA;AAEA;AACA;AACA;;;;;AAEA,MAAM,mBAAmB,IAAI,sJAAA,CAAA,mBAAgB,CAAC,iKAAA,CAAA,UAAW,EAAE,gJAAA,CAAA,YAAS;AAE7D,eAAe,KAAK,GAAY;IACrC,IAAI;QACF,MAAM,OAAgC,MAAM,IAAI,IAAI;QACpD,MAAM,SAAS,MAAM,iBAAiB,cAAc,CAAC,KAAK,QAAQ;QAElE,QAAQ,GAAG,CAAC;QAEZ,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CAAC,CAAC,GAAG;YAAE,QAAQ;QAAI;IAC7C,EAAE,OAAM;QACN,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CAAC;YAAE,SAAS;QAAuB,GAAG;YAAE,QAAQ;QAAI;IAC9E;AACF","debugId":null}}]
}