(()=>{var e={};e.id=902,e.ids=[902],e.modules={846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},1020:(e,t,r)=>{"use strict";r.d(t,{X:()=>i});var s=r(4882),o=r(6037),n=r.n(o);let a=s.x.mongoUrl;if(!a)throw Error("⚠️ MONGO_URI n\xe3o foi definida no .env");let i=async()=>{n().connection.readyState,await n().connect(a)}},1885:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>y,routeModule:()=>l,serverHooks:()=>w,workAsyncStorage:()=>h,workUnitAsyncStorage:()=>m});var s={};r.r(s),r.d(s,{POST:()=>u});var o=r(6559),n=r(8088),a=r(7719),i=r(2190),c=r(1020),p=r(8509);let d=new(r(4633)).g(p.A,c.X);async function u(e){try{let t=await e.json();try{let{clientId:e,qty:r}=t.data.object.metadata,s=t.data.object.status;if("complete"!==s||!e)return i.NextResponse.json({},{status:400});return await d.incrementClientTokens(e,r),i.NextResponse.json({},{status:200})}catch{return i.NextResponse.json({message:"N\xe3o foi poss\xedvel processar o pagamento!"},{status:400})}}catch{return i.NextResponse.json({message:"Nenhum dado encontrado no corpo da requisi\xe7\xe3o!"},{status:400})}}let l=new o.AppRouteRouteModule({definition:{kind:n.RouteKind.APP_ROUTE,page:"/api/payment/webhook-process/route",pathname:"/api/payment/webhook-process",filename:"route",bundlePath:"app/api/payment/webhook-process/route"},resolvedPagePath:"/home/fr/atendente-bot/src/app/api/payment/webhook-process/route.ts",nextConfigOutput:"",userland:s}),{workAsyncStorage:h,workUnitAsyncStorage:m,serverHooks:w}=l;function y(){return(0,a.patchFetch)({workAsyncStorage:h,workUnitAsyncStorage:m})}},3033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},4633:(e,t,r)=>{"use strict";r.d(t,{g:()=>s});class s{constructor(e,t){this.clientModel=e,this.connect=t,this.connect()}async upsert(e){try{let t={telephone:e.telephone};return await this.clientModel.findOneAndUpdate(t,e,{upsert:!0,new:!0})}catch(e){throw Error("Client not created or updated!",{cause:e})}}async getByTelephone(e){try{let t=await this.clientModel.findOne({telephone:e});if(!t)throw Error("Client not found!");return t}catch(e){throw Error(e.message)}}async deleteByTelephone(e){try{let t=await this.clientModel.deleteOne({telephone:e});if(0===t.deletedCount)throw Error("None deleted!")}catch{throw Error("It was not possible delete user by db!")}}async decrementClientTokens(e){try{let t=await this.clientModel.updateOne({_id:e},{$inc:{messageTokens:-1}});if(0===t.modifiedCount)throw Error("None updated!")}catch{throw Error("It was not possible decrement user tokens!")}}async incrementClientTokens(e,t){try{let r=await this.clientModel.updateOne({_id:e},{$inc:{messageTokens:t}});if(0===r.modifiedCount)throw Error("None updated!")}catch{throw Error("It was not possible increment user tokens!")}}}},4870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},4882:(e,t,r)=>{"use strict";r.d(t,{x:()=>s});let s={evolutionBaseUrl:process.env.EVOLUTION_BASE_URL,evolutionApiKey:process.env.EVOLUTION_API_KEY,mongoUrl:process.env.MONGO_URL,webhookSendMessageUrl:process.env.WEBHOOK_SEND_MESSAGE_URL,openAiBaseUrl:process.env.OPEN_AI_BASE_URL,openAiApiKey:process.env.OPEN_AI_API_KEY,stripeCallbackUrl:process.env.STRIPE_CALLBACK_URL,stripeApiCompleteKey:process.env.STRIPE_API_COMPLETE_KEY,stripePriceKey:process.env.STRIPE_PRICE_KEY}},6037:e=>{"use strict";e.exports=require("mongoose")},6487:()=>{},8335:()=>{},8509:(e,t,r)=>{"use strict";r.d(t,{A:()=>a});var s=r(6037),o=r.n(s);let n=new s.Schema({telephone:{type:String,required:!0},authCode:{type:String,required:!0},messageTokens:{type:Number,required:!1}},{timestamps:!0}),a=o().models.Client||o().model("Client",n)},9294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[447,580],()=>r(1885));module.exports=s})();