(()=>{var e={};e.id=254,e.ids=[254],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},4882:(e,t,r)=>{"use strict";r.d(t,{xK:()=>s});let s={evolutionBaseUrl:process.env.EVOLUTION_BASE_URL,evolutionApiKey:process.env.EVOLUTION_API_KEY,mongoUrl:process.env.MONGO_URL,webhookSendMessageUrl:process.env.WEBHOOK_SEND_MESSAGE_URL,openAiBaseUrl:process.env.OPEN_AI_BASE_URL,openAiApiKey:process.env.OPEN_AI_API_KEY,stripeCallbackUrl:process.env.STRIPE_CALLBACK_URL,stripeApiCompleteKey:process.env.STRIPE_API_COMPLETE_KEY,stripePriceKey:process.env.STRIPE_PRICE_KEY}},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},12412:e=>{"use strict";e.exports=require("assert")},21820:e=>{"use strict";e.exports=require("os")},27910:e=>{"use strict";e.exports=require("stream")},28354:e=>{"use strict";e.exports=require("util")},29021:e=>{"use strict";e.exports=require("fs")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},32719:(e,t,r)=>{"use strict";r.d(t,{x:()=>i});var s=r(94612),n=r(82410),a=r(4882);class i{static{this.httpClient=s.A.create({baseURL:a.xK.evolutionBaseUrl,headers:{apiKey:a.xK.evolutionApiKey}})}static async getState(e){let t=`instance/connectionState/${e}`;try{return(await this.httpClient.get(t)).data}catch{return{instance:{instanceName:e,state:n.d.NOT_FOUND}}}}static async newInstance(e){let t="instance/create";try{await this.httpClient.post(t,e)}catch{throw Error(t)}}static async instanceConnect(e){let t=`instance/connect/${e}`;try{let r=(await this.httpClient.get(t,{params:{number:e}})).data;if(!r.code||!r.base64||!r.pairingCode)throw Error(`${t}: Evolution codes not generated!`);return r}catch{throw Error(t)}}static async sendMessage(e,t){let r=`message/sendText/${e}`;try{await this.httpClient.post(r,t)}catch{throw Error(r)}}static async deleteInstance(e){let t=`instance/delete/${e}`;try{await this.httpClient.delete(t)}catch{throw Error(t)}}static async logoutInstance(e){let t=`instance/logout/${e}`;try{await this.httpClient.delete(t)}catch{throw Error(t)}}static async fetchInstance(e){let t="instance/fetchInstances";try{return(await this.httpClient.get(t,{params:{instanceName:e}})).data}catch{throw Error(t)}}static async changeWebhookStatus(e,t){let r=`webhook/set/${e}`,s={webhook:{enabled:t,events:["MESSAGES_UPSERT","CONNECTION_UPDATE"],url:a.xK.webhookSendMessageUrl||""}};try{await this.httpClient.post(r,s)}catch{throw Error(r)}}static async webhookStatus(e){let t=`webhook/find/${e}`;try{return{enabled:(await this.httpClient.get(t)).data.enabled}}catch{throw Error(t)}}}},33873:e=>{"use strict";e.exports=require("path")},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},55511:e=>{"use strict";e.exports=require("crypto")},55591:e=>{"use strict";e.exports=require("https")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},71735:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>x,routeModule:()=>l,serverHooks:()=>w,workAsyncStorage:()=>h,workUnitAsyncStorage:()=>d});var s={};r.r(s),r.d(s,{POST:()=>u});var n=r(96559),a=r(48088),i=r(37719),o=r(32190),c=r(32719),p=r(82410);async function u(e){try{let t=await e.json();if(t.data.state===p.d.OPEN){let e=(await new Promise(e=>setTimeout(()=>{e(c.x.fetchInstance(t.instance))},2e3)))[0].ownerJid.slice(4).replace("@s.whatsapp.net","");if(!(8===e.length?`55799${e}`:`5579${e}`).startsWith(t.instance))return await c.x.logoutInstance(t.instance),await new Promise(e=>setTimeout(()=>{e(c.x.deleteInstance(t.instance))},3e3)),o.NextResponse.json({},{status:404})}return o.NextResponse.json({},{status:200})}catch{return o.NextResponse.json({},{status:400})}}let l=new n.AppRouteRouteModule({definition:{kind:a.RouteKind.APP_ROUTE,page:"/api/client/webhook/connection-update/route",pathname:"/api/client/webhook/connection-update",filename:"route",bundlePath:"app/api/client/webhook/connection-update/route"},resolvedPagePath:"/home/fr/atendente-bot/src/app/api/client/webhook/connection-update/route.ts",nextConfigOutput:"",userland:s}),{workAsyncStorage:h,workUnitAsyncStorage:d,serverHooks:w}=l;function x(){return(0,i.patchFetch)({workAsyncStorage:h,workUnitAsyncStorage:d})}},74075:e=>{"use strict";e.exports=require("zlib")},78335:()=>{},79551:e=>{"use strict";e.exports=require("url")},81630:e=>{"use strict";e.exports=require("http")},82410:(e,t,r)=>{"use strict";r.d(t,{d:()=>s});var s=function(e){return e.OPEN="open",e.CLOSE="close",e.NOT_FOUND="not_found",e}({})},83997:e=>{"use strict";e.exports=require("tty")},94735:e=>{"use strict";e.exports=require("events")},96487:()=>{}};var t=require("../../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[447,580,612],()=>r(71735));module.exports=s})();