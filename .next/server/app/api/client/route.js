(()=>{var e={};e.id=27,e.ids=[27],e.modules={846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},1020:(e,t,s)=>{"use strict";s.d(t,{X:()=>i});var r=s(4882),n=s(6037),o=s.n(n);let a=r.x.mongoUrl;if(!a)throw Error("⚠️ MONGO_URI n\xe3o foi definida no .env");let i=async()=>{o().connection.readyState,await o().connect(a)}},1630:e=>{"use strict";e.exports=require("http")},1820:e=>{"use strict";e.exports=require("os")},2410:(e,t,s)=>{"use strict";s.d(t,{d:()=>r});var r=function(e){return e.OPEN="open",e.CLOSE="close",e.NOT_FOUND="not_found",e}({})},2412:e=>{"use strict";e.exports=require("assert")},2719:(e,t,s)=>{"use strict";s.d(t,{x:()=>a});var r=s(4612),n=s(2410),o=s(4882);class a{static{this.httpClient=r.A.create({baseURL:o.x.evolutionBaseUrl,headers:{apiKey:o.x.evolutionApiKey}})}static async getState(e){let t=`instance/connectionState/${e}`;try{return(await this.httpClient.get(t)).data}catch{return{instance:{instanceName:e,state:n.d.NOT_FOUND}}}}static async newInstance(e){let t="instance/create";try{await this.httpClient.post(t,e)}catch{throw Error(t)}}static async instanceConnect(e){let t=`instance/connect/${e}`;try{let s=(await this.httpClient.get(t,{params:{number:e}})).data;if(!s.code||!s.base64||!s.pairingCode)throw Error(`${t}: Evolution codes not generated!`);return s}catch{throw Error(t)}}static async sendMessage(e,t){let s=`message/sendText/${e}`;try{await this.httpClient.post(s,t)}catch{throw Error(s)}}static async deleteInstance(e){let t=`instance/delete/${e}`;try{await this.httpClient.delete(t)}catch{throw Error(t)}}static async logoutInstance(e){let t=`instance/logout/${e}`;try{await this.httpClient.delete(t)}catch{throw Error(t)}}}},3033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},3873:e=>{"use strict";e.exports=require("path")},3997:e=>{"use strict";e.exports=require("tty")},4075:e=>{"use strict";e.exports=require("zlib")},4633:(e,t,s)=>{"use strict";s.d(t,{g:()=>r});class r{constructor(e,t){this.clientModel=e,this.connect=t,this.connect()}async upsert(e){try{let t={telephone:e.telephone};return await this.clientModel.findOneAndUpdate(t,e,{upsert:!0,new:!0})}catch(e){throw Error("Client not created or updated!",{cause:e})}}async getByTelephone(e){try{let t=await this.clientModel.findOne({telephone:e});if(!t)throw Error("Client not found!");return t}catch(e){throw Error(e.message)}}async deleteByTelephone(e){try{let t=await this.clientModel.deleteOne({telephone:e});if(0===t.deletedCount)throw Error("None deleted!")}catch{throw Error("It was not possible delete user by db!")}}async decrementClientTokens(e){try{let t=await this.clientModel.updateOne({_id:e},{$inc:{messageTokens:-1}});if(0===t.modifiedCount)throw Error("None updated!")}catch{throw Error("It was not possible decrement user tokens!")}}async incrementClientTokens(e,t){try{let s=await this.clientModel.updateOne({_id:e},{$inc:{messageTokens:t}});if(0===s.modifiedCount)throw Error("None updated!")}catch{throw Error("It was not possible increment user tokens!")}}}},4735:e=>{"use strict";e.exports=require("events")},4870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},4882:(e,t,s)=>{"use strict";s.d(t,{x:()=>r});let r={evolutionBaseUrl:process.env.EVOLUTION_BASE_URL,evolutionApiKey:process.env.EVOLUTION_API_KEY,mongoUrl:process.env.MONGO_URL,webhookSendMessageUrl:process.env.WEBHOOK_SEND_MESSAGE_URL,openAiBaseUrl:process.env.OPEN_AI_BASE_URL,openAiApiKey:process.env.OPEN_AI_API_KEY,stripeCallbackUrl:process.env.STRIPE_CALLBACK_URL,stripeApiCompleteKey:process.env.STRIPE_API_COMPLETE_KEY,stripePriceKey:process.env.STRIPE_PRICE_KEY}},5511:e=>{"use strict";e.exports=require("crypto")},5591:e=>{"use strict";e.exports=require("https")},6037:e=>{"use strict";e.exports=require("mongoose")},6303:(e,t,s)=>{"use strict";s.d(t,{y:()=>d});var r=s(2190),n=s(8337),o=s(2410),a=s(2719),i=s(4633),c=s(8509),u=s(1020);let l=new i.g(c.A,u.X),d=async(e,t)=>{let s=e.headers.get("authCode"),i=e.headers.get("telephone");if(!s)return r.NextResponse.json({message:"O c\xf3digo de autoriza\xe7\xe3o \xe9 obrigat\xf3rio no cabe\xe7alho!"},{status:400});if(!i)return r.NextResponse.json({message:"O telefone \xe9 obrigat\xf3rio no cabe\xe7alho!"},{status:400});if(!(0,n.h)(i))return r.NextResponse.json({message:"Telefone inv\xe1lido! O formato correto \xe9 +55 (XX) 9XXXX-XXXX."},{status:400});if((await a.x.getState(i)).instance.state!==o.d.OPEN)return r.NextResponse.json({message:"Esse telefone n\xe3o est\xe1 conectado!"},{status:403});try{let e=await l.getByTelephone(i);if(s!==e.authCode)return r.NextResponse.json({message:"C\xf3digo de autoriza\xe7\xe3o inv\xe1lido!"},{status:403});return t()}catch{return r.NextResponse.json({message:"Cliente n\xe3o encontrado!"},{status:404})}}},6487:()=>{},7910:e=>{"use strict";e.exports=require("stream")},8335:()=>{},8337:(e,t,s)=>{"use strict";s.d(t,{h:()=>r});let r=e=>/^\+?55\s?\(?\d{2}\)?\s?9\d{4}-?\d{4}$/.test(e)},8354:e=>{"use strict";e.exports=require("util")},8458:(e,t,s)=>{"use strict";s.r(t),s.d(t,{patchFetch:()=>C,routeModule:()=>w,serverHooks:()=>v,workAsyncStorage:()=>f,workUnitAsyncStorage:()=>E});var r={};s.r(r),s.d(r,{DELETE:()=>y,GET:()=>m});var n=s(6559),o=s(8088),a=s(7719),i=s(2190),c=s(4633),u=s(8509),l=s(1020),d=s(8337),p=s(2719),h=s(2410),g=s(6303);let x=new c.g(u.A,l.X);async function m(e){try{let{url:t}=e,{searchParams:s}=new URL(t),r=s.get("telephone"),n=s.get("authCode");if(!r)return i.NextResponse.json({message:"Telefone \xe9 obrigat\xf3rio!"},{status:400});if(!n)return i.NextResponse.json({message:"C\xf3digo de autoriza\xe7\xe3o \xe9 obrigat\xf3rio!"},{status:400});if(!(0,d.h)(r))return i.NextResponse.json({message:"Telefone inv\xe1lido! O formato correto \xe9 +55 (XX) 9XXXX-XXXX."},{status:400});if((await p.x.getState(r)).instance.state!==h.d.OPEN)return i.NextResponse.json({message:"Esse telefone n\xe3o est\xe1 conectado!"},{status:403});try{let e=await x.getByTelephone(r);if(n!==e.authCode)return i.NextResponse.json({message:"C\xf3digo de autoriza\xe7\xe3o inv\xe1lido!"},{status:403});return i.NextResponse.json({data:e},{status:200})}catch{return i.NextResponse.json({message:"Cliente n\xe3o encontrado!"},{status:404})}}catch{return i.NextResponse.json({message:"N\xe3o foi poss\xedvel obter os dados do telefone!"},{status:404})}}async function y(e){let t=async()=>{try{let t=await e.json();try{let{telephone:e}=t;if(!e)return i.NextResponse.json({message:"O telefone \xe9 obrigat\xf3rio!"},{status:400});return await p.x.logoutInstance(e),await new Promise(t=>setTimeout(()=>{t(p.x.deleteInstance(e))},3e3)),await x.upsert({telephone:e,authCode:""}),i.NextResponse.json({message:"Conex\xe3o finalizada!"},{status:200})}catch{return i.NextResponse.json({message:"N\xe3o foi poss\xedvel finalizar a conex\xe3o!"},{status:400})}}catch{return i.NextResponse.json({message:"Nenhum dado enviado!"},{status:400})}};return await (0,g.y)(e,t)}let w=new n.AppRouteRouteModule({definition:{kind:o.RouteKind.APP_ROUTE,page:"/api/client/route",pathname:"/api/client",filename:"route",bundlePath:"app/api/client/route"},resolvedPagePath:"/home/fr/atendente-bot/src/app/api/client/route.ts",nextConfigOutput:"",userland:r}),{workAsyncStorage:f,workUnitAsyncStorage:E,serverHooks:v}=w;function C(){return(0,a.patchFetch)({workAsyncStorage:f,workUnitAsyncStorage:E})}},8509:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});var r=s(6037),n=s.n(r);let o=new r.Schema({telephone:{type:String,required:!0},authCode:{type:String,required:!0},messageTokens:{type:Number,required:!1}},{timestamps:!0}),a=n().models.Client||n().model("Client",o)},9021:e=>{"use strict";e.exports=require("fs")},9294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},9551:e=>{"use strict";e.exports=require("url")}};var t=require("../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),r=t.X(0,[447,580,612],()=>s(8458));module.exports=r})();