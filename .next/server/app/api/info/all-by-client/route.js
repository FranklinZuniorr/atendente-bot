(()=>{var e={};e.id=932,e.ids=[932],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},4882:(e,t,r)=>{"use strict";r.d(t,{xK:()=>s});let s={evolutionBaseUrl:process.env.EVOLUTION_BASE_URL,evolutionApiKey:process.env.EVOLUTION_API_KEY,mongoUrl:process.env.MONGO_URL,webhookSendMessageUrl:process.env.WEBHOOK_SEND_MESSAGE_URL,openAiBaseUrl:process.env.OPEN_AI_BASE_URL,openAiApiKey:process.env.OPEN_AI_API_KEY,stripeCallbackUrl:process.env.STRIPE_CALLBACK_URL,stripeApiCompleteKey:process.env.STRIPE_API_COMPLETE_KEY,stripePriceKey:process.env.STRIPE_PRICE_KEY}},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},12412:e=>{"use strict";e.exports=require("assert")},21820:e=>{"use strict";e.exports=require("os")},24633:(e,t,r)=>{"use strict";r.d(t,{g:()=>s});class s{constructor(e,t){this.clientModel=e,this.connect=t,this.connect()}async upsert(e){try{let t={telephone:e.telephone};return await this.clientModel.findOneAndUpdate(t,e,{upsert:!0,new:!0})}catch(e){throw Error("Client not created or updated!",{cause:e})}}async getByTelephone(e){try{let t=await this.clientModel.findOne({telephone:e});if(!t)throw Error("Client not found!");return t}catch(e){throw Error(e.message)}}async deleteByTelephone(e){try{let t=await this.clientModel.deleteOne({telephone:e});if(0===t.deletedCount)throw Error("None deleted!")}catch{throw Error("It was not possible delete user by db!")}}async decrementClientTokens(e){try{let t=await this.clientModel.updateOne({_id:e},{$inc:{messageTokens:-1}});if(0===t.modifiedCount)throw Error("None updated!")}catch{throw Error("It was not possible decrement user tokens!")}}async incrementClientTokens(e,t){try{let r=await this.clientModel.updateOne({_id:e},{$inc:{messageTokens:t}});if(0===r.modifiedCount)throw Error("None updated!")}catch{throw Error("It was not possible increment user tokens!")}}}},27910:e=>{"use strict";e.exports=require("stream")},28354:e=>{"use strict";e.exports=require("util")},28509:(e,t,r)=>{"use strict";r.d(t,{A:()=>a});var s=r(56037),n=r.n(s);let o=new s.Schema({telephone:{type:String,required:!0},authCode:{type:String,required:!0},messageTokens:{type:Number,required:!1}},{timestamps:!0}),a=n().models.Client||n().model("Client",o)},29021:e=>{"use strict";e.exports=require("fs")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},31020:(e,t,r)=>{"use strict";r.d(t,{X:()=>i});var s=r(4882),n=r(56037),o=r.n(n);let a=s.xK.mongoUrl;if(!a)throw Error("⚠️ MONGO_URI n\xe3o foi definida no .env");let i=async()=>{o().connection.readyState,await o().connect(a)}},32719:(e,t,r)=>{"use strict";r.d(t,{x:()=>a});var s=r(94612),n=r(82410),o=r(4882);class a{static{this.httpClient=s.A.create({baseURL:o.xK.evolutionBaseUrl,headers:{apiKey:o.xK.evolutionApiKey}})}static async getState(e){let t=`instance/connectionState/${e}`;try{return(await this.httpClient.get(t)).data}catch{return{instance:{instanceName:e,state:n.d.NOT_FOUND}}}}static async newInstance(e){let t="instance/create";try{await this.httpClient.post(t,e)}catch{throw Error(t)}}static async instanceConnect(e){let t=`instance/connect/${e}`;try{let r=(await this.httpClient.get(t,{params:{number:e}})).data;if(!r.code||!r.base64||!r.pairingCode)throw Error(`${t}: Evolution codes not generated!`);return r}catch{throw Error(t)}}static async sendMessage(e,t){let r=`message/sendText/${e}`;try{await this.httpClient.post(r,t)}catch{throw Error(r)}}static async deleteInstance(e){let t=`instance/delete/${e}`;try{await this.httpClient.delete(t)}catch{throw Error(t)}}static async logoutInstance(e){let t=`instance/logout/${e}`;try{await this.httpClient.delete(t)}catch{throw Error(t)}}static async fetchInstance(e){let t="instance/fetchInstances";try{return(await this.httpClient.get(t,{params:{instanceName:e}})).data}catch{throw Error(t)}}static async changeWebhookStatus(e,t){let r=`webhook/set/${e}`,s={webhook:{enabled:t,events:["MESSAGES_UPSERT","CONNECTION_UPDATE"],url:o.xK.webhookSendMessageUrl||""}};try{await this.httpClient.post(r,s)}catch{throw Error(r)}}static async webhookStatus(e){let t=`webhook/find/${e}`;try{return{enabled:(await this.httpClient.get(t)).data.enabled}}catch{throw Error(t)}}}},33873:e=>{"use strict";e.exports=require("path")},38337:(e,t,r)=>{"use strict";r.d(t,{h:()=>s});let s=e=>/^\+?55\s?\(?\d{2}\)?\s?9\d{4}-?\d{4}$/.test(e)},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},55511:e=>{"use strict";e.exports=require("crypto")},55591:e=>{"use strict";e.exports=require("https")},56037:e=>{"use strict";e.exports=require("mongoose")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},63657:(e,t,r)=>{"use strict";r.d(t,{A:()=>a});var s=r(56037),n=r.n(s);let o=new s.Schema({title:{type:String,required:!0},description:{type:String,required:!0},clientId:{type:String,required:!0}},{timestamps:!0}),a=n().models.Info||n().model("Info",o)},66598:(e,t,r)=>{"use strict";r.d(t,{R:()=>s});class s{constructor(e,t){this.infoModel=e,this.connect=t,this.connect()}async create(e){try{await this.infoModel.insertOne(e)}catch(e){throw Error("Info not created!",{cause:e})}}async update(e,t){try{let r=await this.infoModel.updateOne({_id:t},e);if(0===r.modifiedCount)throw Error("None updated!")}catch(e){throw Error("Info not updated!",{cause:e})}}async delete(e){try{let t=await this.infoModel.deleteOne({_id:e});if(0===t.deletedCount)throw Error("None deleted!")}catch(e){throw Error("Info not deleted!",{cause:e})}}async getAllByClientId(e){try{let t=await this.infoModel.find({clientId:e});if(0===t.length)throw Error("None info founded!");return t}catch(t){throw Error(`Infos of ${e} not founded!`,{cause:t})}}}},74075:e=>{"use strict";e.exports=require("zlib")},78335:()=>{},79551:e=>{"use strict";e.exports=require("url")},81220:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>E,routeModule:()=>y,serverHooks:()=>g,workAsyncStorage:()=>w,workUnitAsyncStorage:()=>f});var s={};r.r(s),r.d(s,{GET:()=>h});var n=r(96559),o=r(48088),a=r(37719),i=r(32190),c=r(31020),l=r(63657),d=r(66598),u=r(86303);let p=new d.R(l.A,c.X);async function h(e){let t=async()=>{try{let{url:t}=e,{searchParams:r}=new URL(t),s=r.get("clientId");if(!s)return i.NextResponse.json({message:"O id do cliente \xe9 orbigat\xf3rio!"},{status:400});let n=await p.getAllByClientId(s);return i.NextResponse.json({data:n},{status:200})}catch{return i.NextResponse.json({message:"Nenhuma informa\xe7\xe3o encontrada!"},{status:400})}};return await (0,u.y)(e,t)}let y=new n.AppRouteRouteModule({definition:{kind:o.RouteKind.APP_ROUTE,page:"/api/info/all-by-client/route",pathname:"/api/info/all-by-client",filename:"route",bundlePath:"app/api/info/all-by-client/route"},resolvedPagePath:"/home/fr/atendente-bot/src/app/api/info/all-by-client/route.ts",nextConfigOutput:"",userland:s}),{workAsyncStorage:w,workUnitAsyncStorage:f,serverHooks:g}=y;function E(){return(0,a.patchFetch)({workAsyncStorage:w,workUnitAsyncStorage:f})}},81630:e=>{"use strict";e.exports=require("http")},82410:(e,t,r)=>{"use strict";r.d(t,{d:()=>s});var s=function(e){return e.OPEN="open",e.CLOSE="close",e.NOT_FOUND="not_found",e}({})},83997:e=>{"use strict";e.exports=require("tty")},86303:(e,t,r)=>{"use strict";r.d(t,{y:()=>u});var s=r(32190),n=r(38337),o=r(82410),a=r(32719),i=r(24633),c=r(28509),l=r(31020);let d=new i.g(c.A,l.X),u=async(e,t)=>{let r=e.headers.get("authCode"),i=e.headers.get("telephone");if(!r)return s.NextResponse.json({message:"O c\xf3digo de autoriza\xe7\xe3o \xe9 obrigat\xf3rio no cabe\xe7alho!"},{status:400});if(!i)return s.NextResponse.json({message:"O telefone \xe9 obrigat\xf3rio no cabe\xe7alho!"},{status:400});if(!(0,n.h)(i))return s.NextResponse.json({message:"Telefone inv\xe1lido! O formato correto \xe9 +55 (XX) 9XXXX-XXXX."},{status:400});if((await a.x.getState(i)).instance.state!==o.d.OPEN)return s.NextResponse.json({message:"Esse telefone n\xe3o est\xe1 conectado!"},{status:403});try{let e=await d.getByTelephone(i);if(r!==e.authCode)return s.NextResponse.json({message:"C\xf3digo de autoriza\xe7\xe3o inv\xe1lido!"},{status:403});return t()}catch{return s.NextResponse.json({message:"Cliente n\xe3o encontrado!"},{status:404})}}},94735:e=>{"use strict";e.exports=require("events")},96487:()=>{}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[447,580,612],()=>r(81220));module.exports=s})();